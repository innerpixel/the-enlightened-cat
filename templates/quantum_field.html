{% extends "base.html" %}

{% block head %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500&display=swap" rel="stylesheet">
<style>
    /* Particle background */
    #particles-js {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        pointer-events: none;
    }
    
    .quantum-field-container {
        max-width: 900px;
        margin: 2rem auto;
        padding: 2rem;
        background-color: rgba(65, 51, 23, 0.85);
        border-radius: 15px;
        box-shadow: 0 0 30px rgba(248, 147, 86, 0.25);
        color: #f0f0f0;
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
    }
    
    /* Glow effect behind container */
    .quantum-field-container::before {
        content: '';
        position: absolute;
        top: -50px;
        left: -50px;
        right: -50px;
        bottom: -50px;
        background: radial-gradient(circle at center, rgba(248, 147, 86, 0.2) 0%, rgba(65, 51, 23, 0) 70%);
        z-index: -1;
        opacity: 0.7;
        animation: pulse 8s ease-in-out infinite;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 0.7; transform: scale(1); }
        50% { opacity: 0.9; transform: scale(1.05); }
    }
    
    h1 {
        color: #F89356;
        text-align: center;
        font-weight: 500;
        margin-bottom: 1.5rem;
        background: linear-gradient(45deg, #F89356, #f0f0f0);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        font-size: 2.5rem;
        letter-spacing: 1px;
        text-shadow: 0 0 10px rgba(248, 147, 86, 0.5);
    }
    
    .field-explanation {
        margin-bottom: 2rem;
        font-family: 'Cormorant Garamond', serif;
        font-size: 1.2rem;
        line-height: 1.6;
        text-align: center;
        max-width: 80%;
        margin-left: auto;
        margin-right: auto;
    }
    
    .field-explanation p {
        margin-bottom: 0.8rem;
        opacity: 0.9;
    }
    
    .field-explanation em {
        color: #F89356;
        font-style: italic;
        opacity: 1;
    }
    
    .wisdom-field {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 1.5rem;
        margin: 2rem 0;
        perspective: 1000px;
    }
    
    .wisdom-node {
        position: relative;
        min-height: 150px;
        background-color: rgba(136, 144, 132, 0.15);
        border: 1px solid rgba(248, 147, 86, 0.3);
        border-radius: 10px;
        padding: 1.5rem;
        cursor: pointer;
        transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        overflow: hidden;
        animation: float 6s ease-in-out infinite;
        filter: blur(2px);
        transform-style: preserve-3d;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2), 0 0 5px rgba(248, 147, 86, 0.2);
    }
    
    /* Glowing border effect */
    .wisdom-node::after {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, rgba(248, 147, 86, 0.1), rgba(248, 147, 86, 0.3), rgba(248, 147, 86, 0.1));
        border-radius: 12px;
        z-index: -1;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .wisdom-node:hover {
        filter: blur(0);
        transform: translateY(-5px) translateZ(20px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3), 0 0 15px rgba(248, 147, 86, 0.4);
        background-color: rgba(136, 144, 132, 0.25);
    }
    
    .wisdom-node:hover::after {
        opacity: 1;
    }
    
    @keyframes float {
        0% {
            transform: translateY(0px) translateZ(0px) rotate(0deg);
        }
        50% {
            transform: translateY(-10px) translateZ(10px) rotate(0.5deg);
        }
        100% {
            transform: translateY(0px) translateZ(0px) rotate(0deg);
        }
    }
    
    .node-domain {
        font-weight: 500;
        margin-bottom: 0.8rem;
        color: #F89356;
        text-shadow: 0 0 5px rgba(248, 147, 86, 0.3);
        font-size: 1.2rem;
        letter-spacing: 0.5px;
    }
    
    .node-seed {
        font-family: 'Cormorant Garamond', serif;
        font-style: italic;
        font-size: 1.1rem;
        line-height: 1.4;
        opacity: 0.9;
        transition: opacity 0.3s ease;
    }
    
    .wisdom-node:hover .node-seed {
        opacity: 1;
    }
    
    .collapsed-prompt {
        margin-top: 2rem;
        padding: 2rem;
        background-color: rgba(136, 144, 132, 0.15);
        border-radius: 10px;
        border: 1px solid rgba(248, 147, 86, 0.3);
        text-align: center;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.8s ease;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        position: relative;
        overflow: hidden;
    }
    
    /* Subtle glow effect */
    .collapsed-prompt::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at center, rgba(248, 147, 86, 0.1) 0%, rgba(0, 0, 0, 0) 70%);
        opacity: 0;
        transition: opacity 0.8s ease;
    }
    
    .collapsed-prompt.visible {
        opacity: 1;
        transform: translateY(0);
    }
    
    .collapsed-prompt.visible::before {
        opacity: 1;
    }
    
    .prompt-text {
        font-family: 'Cormorant Garamond', serif;
        font-size: 1.3rem;
        line-height: 1.6;
        margin-bottom: 1.5rem;
        position: relative;
        text-shadow: 0 0 2px rgba(248, 147, 86, 0.2);
    }
    
    .quantum-image {
        max-width: 100%;
        height: auto;
        border-radius: 15px;
        margin-top: 1.5rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        opacity: 0;
        transform: scale(0.9);
        transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        filter: saturate(1.1) contrast(1.1);
    }
    
    .quantum-image.visible {
        opacity: 1;
        transform: scale(1);
    }
    
    .loading-spinner {
        display: block;
        width: 50px;
        height: 50px;
        margin: 2rem auto;
        border: 5px solid rgba(136, 144, 132, 0.3);
        border-radius: 50%;
        border-top-color: #F89356;
        animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    .hidden {
        display: none;
    }
    
    /* Share button styles removed */
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .wisdom-field {
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(3, 1fr);
        }
        
        .wisdom-node {
            min-height: 120px;
            padding: 1rem;
        }
    }
    
    @media (max-width: 480px) {
        .wisdom-field {
            grid-template-columns: 1fr;
            grid-template-rows: repeat(6, 1fr);
        }
        
        h1 {
            font-size: 2rem;
        }
        
        .field-explanation {
            font-size: 1rem;
        }
    }
</style>
{% endblock %}

{% block title %}Quantum Field | The Enlightened Cat{% endblock %}

{% block content %}
<!-- Particle background container -->
<div id="particles-js"></div>

<div class="quantum-field-container">
    <h1>6-Fold Wisdom Field</h1>
    
    <div class="field-explanation">
        <p>The Enlightened Cat presents a field of quantum wisdom in perfect 6-fold symmetry.</p>
        <p>Six wisdom nodes form a harmonic field, each representing a dimension of awareness.</p>
        <p>All exist in superposition until you choose one, collapsing the field into a single resonant prompt.</p>
        <p><em>"The observer creates reality by the act of observation."</em></p>
    </div>
    
    <div id="wisdom-field" class="wisdom-field">
        <div class="loading-spinner"></div>
    </div>
    
    <div id="collapsed-prompt" class="collapsed-prompt hidden">
        <h2>Collapsed Wisdom</h2>
        <div id="prompt-text" class="prompt-text"></div>
        <div id="image-container">
            <div id="loading-image" class="loading-spinner hidden"></div>
            <img id="quantum-image" class="quantum-image hidden" alt="Quantum visualization">
        </div>
        <!-- Sharing functionality removed -->
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Particles.js for background effects -->
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const wisdomField = document.getElementById('wisdom-field');
    const collapsedPrompt = document.getElementById('collapsed-prompt');
    const promptText = document.getElementById('prompt-text');
    const quantumImage = document.getElementById('quantum-image');
    const loadingImage = document.getElementById('loading-image');
    
    // Initialize particles.js
    if (typeof particlesJS !== 'undefined') {
        particlesJS('particles-js', {
            particles: {
                number: { value: 80, density: { enable: true, value_area: 800 } },
                color: { value: "#F89356" },
                shape: { type: "circle" },
                opacity: { 
                    value: 0.5, 
                    random: true,
                    anim: { enable: true, speed: 1, opacity_min: 0.1, sync: false }
                },
                size: { 
                    value: 3, 
                    random: true,
                    anim: { enable: true, speed: 2, size_min: 0.3, sync: false }
                },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: "#889084",
                    opacity: 0.2,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 1,
                    direction: "none",
                    random: true,
                    straight: false,
                    out_mode: "out",
                    bounce: false,
                    attract: { enable: true, rotateX: 600, rotateY: 1200 }
                }
            },
            interactivity: {
                detect_on: "canvas",
                events: {
                    onhover: { enable: true, mode: "grab" },
                    onclick: { enable: true, mode: "push" },
                    resize: true
                },
                modes: {
                    grab: { distance: 140, line_linked: { opacity: 0.5 } },
                    push: { particles_nb: 4 }
                }
            },
            retina_detect: true
        });
    }
    
    // Domain definitions with descriptions and colors
    const domains = [
        { index: 1, name: "Essence", description: "Core truth or soul resonance", color: "#F89356" },
        { index: 2, name: "Inner Path", description: "Internal reflection, personal myth", color: "#e87d36" },
        { index: 3, name: "Outer Path", description: "Action or movement in the world", color: "#d76b29" },
        { index: 4, name: "Portal", description: "Invitation, threshold, or call", color: "#c65a1c" },
        { index: 5, name: "Friction", description: "Challenge, tension, or transformation", color: "#b54a10" },
        { index: 6, name: "Crystallization", description: "Integration, revelation, or clarity", color: "#a43a04" }
    ];
    
    // Fetch the wisdom field
    fetch('/api/quantum-field')
        .then(response => response.json())
        .then(data => {
            wisdomField.innerHTML = '';
            
            // Create wisdom nodes with enhanced visual effects
            data.wisdom_field.forEach((node, index) => {
                const domain = domains[index];
                const nodeElement = document.createElement('div');
                nodeElement.className = 'wisdom-node';
                
                // Add random animation delay for more organic movement
                nodeElement.style.animationDelay = `${Math.random() * 3}s`;
                nodeElement.style.animationDuration = `${5 + Math.random() * 4}s`; // Between 5-9s
                
                // Add subtle rotation for 3D effect
                nodeElement.style.transform = `rotateX(${Math.random() * 5 - 2.5}deg) rotateY(${Math.random() * 5 - 2.5}deg)`;
                
                // Create a subtle gradient background based on domain color
                nodeElement.style.background = `radial-gradient(circle at center, rgba(136, 144, 132, 0.2) 0%, rgba(136, 144, 132, 0.15) 70%)`;
                nodeElement.style.borderColor = domain.color;
                
                nodeElement.innerHTML = `
                    <div class="node-domain" style="color: ${domain.color}">${domain.name}</div>
                    <div class="node-seed">${node.seed}</div>
                `;
                
                // Add tooltip with domain description
                nodeElement.setAttribute('title', domain.description);
                
                // Add click event to collapse the field
                nodeElement.addEventListener('click', () => collapseField(index));
                
                // Add hover effect with sound
                nodeElement.addEventListener('mouseenter', () => {
                    try {
                        const hoverSound = new Audio('/static/sounds/hover.mp3');
                        hoverSound.volume = 0.1;
                        hoverSound.play();
                    } catch (e) {
                        // Sound not available, continue silently
                    }
                });
                
                wisdomField.appendChild(nodeElement);
            });
        })
        .catch(error => {
            wisdomField.innerHTML = `<div class="error">Error loading wisdom field: ${error}</div>`;
        });
    
    // Function to collapse the field
    // Add CSS for quantum collapse effect
    const style = document.createElement('style');
    style.textContent = `
        @keyframes quantum-collapse {
            0% { transform: scale(1) rotate(0deg); filter: blur(2px); }
            25% { transform: scale(1.2) rotate(3deg); filter: blur(1px); opacity: 0.9; }
            50% { transform: scale(1.5) rotate(5deg); filter: blur(0); opacity: 0.7; }
            75% { transform: scale(1) rotate(2deg); filter: blur(5px); opacity: 0.4; }
            100% { transform: scale(0) rotate(0deg); filter: blur(10px); opacity: 0; }
        }
        
        @keyframes quantum-selected {
            0% { transform: scale(1); filter: blur(2px); }
            25% { transform: scale(1.1); filter: blur(1px); box-shadow: 0 0 20px #F89356; }
            50% { transform: scale(1.2); filter: blur(0); box-shadow: 0 0 30px #F89356; }
            75% { transform: scale(1.1); filter: blur(0); box-shadow: 0 0 25px #F89356; }
            100% { transform: scale(1); filter: blur(0); box-shadow: 0 0 15px #F89356; }
        }
        
        @keyframes glow-pulse {
            0%, 100% { box-shadow: 0 0 15px #F89356; }
            50% { box-shadow: 0 0 30px #F89356; }
        }
        
        .faded {
            animation: quantum-collapse 1.8s forwards cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .selected {
            animation: quantum-selected 1.8s forwards cubic-bezier(0.175, 0.885, 0.32, 1.275), 
                       glow-pulse 3s 1.8s infinite ease-in-out;
            filter: blur(0) !important;
            z-index: 10;
            position: relative;
        }
    `;
    document.head.appendChild(style);
    
    function collapseField(index) {
        // Play a subtle sound effect if available
        try {
            const audio = new Audio('/static/sounds/quantum-collapse.mp3');
            audio.volume = 0.3;
            audio.play();
        } catch (e) {
            // Sound not available, continue silently
        }
        
        // Disable further clicks
        document.querySelectorAll('.wisdom-node').forEach(node => {
            node.style.pointerEvents = 'none';
        });
        
        // Add a slight delay before starting the collapse animation
        setTimeout(() => {
            // Fade out all non-selected nodes
            document.querySelectorAll('.wisdom-node').forEach((node, i) => {
                if (i !== index) {
                    node.classList.add('faded');
                }
            });
            
            // Highlight the selected node
            document.querySelectorAll('.wisdom-node')[index].classList.add('selected');
            
            // Change particle effect to match the selected node's energy
            if (typeof particlesJS !== 'undefined') {
                const domain = domains[index];
                particlesJS('particles-js', {
                    particles: {
                        number: { value: 120, density: { enable: true, value_area: 800 } },
                        color: { value: domain.color },
                        shape: { type: "circle" },
                        opacity: { value: 0.6, random: true },
                        size: { value: 4, random: true },
                        line_linked: {
                            enable: true,
                            distance: 150,
                            color: domain.color,
                            opacity: 0.3,
                            width: 1
                        },
                        move: {
                            enable: true,
                            speed: 2,
                            direction: "none",
                            random: true,
                            straight: false,
                            out_mode: "out",
                            bounce: false,
                            attract: { enable: true, rotateX: 600, rotateY: 1200 }
                        }
                    }
                });
            }
        }, 300);
        
        // Show loading state with a delay for the animation to complete
        setTimeout(() => {
            loadingImage.classList.remove('hidden');
            collapsedPrompt.classList.remove('hidden');
            
            // Fetch the collapsed prompt
            fetch(`/api/quantum-field/collapse?index=${index}`)
                .then(response => response.json())
                .then(data => {
                    // Display the collapsed prompt with a typing effect
                    typeWriterEffect(data.collapsed_prompt, promptText);
                    collapsedPrompt.classList.add('visible');
                    
                    // Generate and display the image
                    generateImage(data.collapsed_prompt);
                })
                .catch(error => {
                    promptText.textContent = `Error collapsing field: ${error}`;
                    collapsedPrompt.classList.add('visible');
                });
        }, 2000); // Wait for the animation to complete
    }
    
    // Typewriter effect for the collapsed prompt
    function typeWriterEffect(text, element, speed = 30) {
        let i = 0;
        element.textContent = '';
        
        function type() {
            if (i < text.length) {
                element.textContent += text.charAt(i);
                i++;
                setTimeout(type, speed);
            }
        }
        
        type();
    }
    
    // Function to generate an image from the prompt
    function generateImage(prompt) {
        // In a real implementation, this would call an API to generate an image
        // For now, we'll simulate image generation with a timeout
        setTimeout(() => {
            loadingImage.classList.add('hidden');
            
            // For demonstration, we'll use a placeholder image
            // In production, this would be replaced with the generated image URL
            quantumImage.src = '/static/images/quantum-cat.png';
            quantumImage.classList.remove('hidden');
            quantumImage.classList.add('visible');
            
            // Add subtle hover effect to the image
            quantumImage.addEventListener('mouseenter', () => {
                quantumImage.style.transform = 'scale(1.02)';
                quantumImage.style.boxShadow = '0 15px 35px rgba(0, 0, 0, 0.5)';
            });
            
            quantumImage.addEventListener('mouseleave', () => {
                quantumImage.style.transform = 'scale(1)';
                quantumImage.style.boxShadow = '0 10px 30px rgba(0, 0, 0, 0.4)';
            });
        }, 2500);
    }
    
    // Social media sharing functionality removed
});
</script>
{% endblock %}
